<!doctype html><html lang="en"><head><meta charset="UTF-8" /><title>QR Attendance Scanner | Roadmap IT Solutions</title><script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" /><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script><link rel="preconnect" href="https://fonts.googleapis.com" /><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" /><style> :root { --theme-primary: #ff9103; --theme-primary-bg: #fff8e6; --theme-text: #212529; --theme-bg: #f4f6f9; } body { background: var(--theme-bg); font-family: 'Poppins', sans-serif; color: var(--theme-text); } .card { border: none; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); transition: transform 0.2s; } .card-header { background-color: #fff; border-bottom: 1px solid rgba(0, 0, 0, 0.05); padding: 1.25rem; font-weight: 700; color: var(--theme-text); } #reader { width: 100%; border-radius: 8px; overflow: hidden; box-shadow: 0 0 0 4px var(--theme-primary-bg), 0 0 0 5px var(--theme-primary); } .text-primary { color: var(--theme-primary) !important; } .bg-primary { background-color: var(--theme-primary) !important; color: #000 !important; } .btn-primary { background-color: var(--theme-primary); border-color: var(--theme-primary); color: #000; font-weight: 600; } .btn-primary:hover { background-color: #e68200; border-color: #e68200; } .btn-outline-primary { color: var(--theme-primary); border-color: var(--theme-primary); } .btn-outline-primary:hover { background-color: var(--theme-primary); color: #000; } .navbar-custom { background: #fff; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); border-top: 4px solid var(--theme-primary); } .stat-card-icon { width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 10px; font-size: 1.5rem; } .bg-orange-light { background-color: var(--theme-primary-bg); color: var(--theme-primary); } .table-dark { --bs-table-bg: #212529; --bs-table-color: #fff; } #reader__dashboard button { border: 1px solid #a4a4a4; background: #fff; border-radius: 8px; padding: 0.31rem 1.21rem; margin: 0.85rem 0rem; } .table-scroll-area { max-height: 440px; overflow-y: auto; } .table-scroll-area thead th { position: sticky; top: 0; z-index: 10; background-color: #f8f9fa; box-shadow: 0 1px 2px rgba(0,0,0,0.1); } </style></head><body><nav class="navbar navbar-expand-lg navbar-custom mb-4"><div class="container"><a class="navbar-brand fw-bold d-flex align-items-center" href="#"><i class="bi bi-qr-code-scan text-primary fs-3 me-2"></i><span> QR Attendance <span class="text-primary">.Pro</span></span></a><div class="d-flex align-items-center opacity-0"><div class="text-end me-3 d-none d-sm-block"><div class="small text-muted">Current Time</div><div class="fw-bold" id="clock">--:--:--</div></div></div></div></nav><div class="container"><div class="row g-4 mb-4"><div class="col-12 col-lg-4"><div class="card p-3 h-100 d-flex flex-row align-items-center justify-content-between"><div><h6 class="text-muted mb-1">Total Scanned</h6><h3 class="fw-bold mb-0" id="statTotal">0</h3></div><div class="stat-card-icon bg-orange-light"><i class="bi bi-people"></i></div></div></div><div class="col-12 col-lg-4"><div class="card p-3 h-100 d-flex flex-row align-items-center justify-content-between"><div><h6 class="text-muted mb-1">Synced Online</h6><h3 class="fw-bold mb-0 text-success" id="statSynced">0</h3></div><div class="stat-card-icon bg-success-subtle text-success"><i class="bi bi-cloud-check"></i></div></div></div><div class="col-12 col-lg-4"><div class="card p-3 h-100 d-flex flex-row align-items-center justify-content-between"><div><h6 class="text-muted mb-1">Pending Sync</h6><h3 class="fw-bold mb-0 text-warning" id="statPending">0</h3></div><div class="stat-card-icon bg-warning-subtle text-warning"><i class="bi bi-hourglass-split"></i></div></div></div></div><div class="row g-4"><div class="col-12 col-md-10 mx-auto col-lg-4"><div class="card shadow-sm"><div class="card-header d-flex justify-content-between align-items-center"><span><i class="bi bi-camera-video text-primary me-2"></i> Scanner </span><span class="badge bg-danger blink_me">Live</span></div><div class="card-body text-center p-4"><div id="reader"></div><div id="statusMessage" class="mt-3"></div><hr class="my-4 opacity-10" /><label class="form-label text-muted small fw-bold text-start w-100">MANUAL ENTRY</label><div class="input-group"><input type="text" id="manualInput" class="form-control" placeholder="Enter ID or Note" /><button class="btn btn-primary" type="button" id="manualAddBtn"><i class="bi bi-plus-lg"></i></button></div></div></div></div><div class="col-12 col-lg-8"><div class="card shadow-sm h-100"><div class="card-header d-flex justify-content-between align-items-center"><span><i class="bi bi-list-check text-primary me-2"></i> Attendance Log </span><div class="d-flex gap-2"><button id="btnSyncCloud" class="btn btn-sm btn-outline-primary" title="Sync from Cloud"><i class="bi bi-cloud-download"></i></button><div class="dropdown"><button class="btn btn-sm btn-outline-success dropdown-toggle" type="button" data-bs-toggle="dropdown"><i class="bi bi-download"></i> Export </button><ul class="dropdown-menu"><li><a class="dropdown-item" href="#" id="btnExportExcel"><i class="bi bi-file-earmark-excel text-success"></i> Excel </a></li><li><a class="dropdown-item" href="#" id="btnExportPdf"><i class="bi bi-file-earmark-pdf text-danger"></i> PDF </a></li></ul></div><button id="clearBtn" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i> Clear </button></div></div><div class="card-body p-0"><div class="table-responsive table-scroll-area"><table class="table table-hover mb-0 align-middle"><thead class="table-light text-secondary small text-uppercase"><tr><th class="ps-4">#</th><th>Unique ID</th><th>Name</th><th>Scan Time</th><th>Status</th></tr></thead><tbody id="scanTableBody" class="border-top-0"></tbody></table></div><div id="emptyState" class="text-center py-5 d-none"><i class="bi bi-clipboard-x text-muted fs-1"></i><p class="text-muted mt-2">No records found today.</p></div></div></div></div></div></div><footer class="text-center py-4 text-muted small mt-5">&copy; 2026 QR Attendance System. Powered by <a href="http://roadmapit.com" target="_blank" rel="noopener noreferrer">Roadmap IT Solutions Pvt. Ltd.</a></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script><script> const APP_TIMEZONE = 'Asia/Kolkata'; const APP_LOCALE = 'en-GB'; function updateClock() { const now = new Date(); document.getElementById('clock').innerText = now.toLocaleTimeString(APP_LOCALE, { timeZone: APP_TIMEZONE, hour12: true }); } setInterval(updateClock, 1000); updateClock(); $(document).ready(function () { let scannedUsers = JSON.parse(localStorage.getItem('scannedUsers')) || []; let masterNameList = JSON.parse(localStorage.getItem('qrcodeNameList')) || {}; let isClearing = false; const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzJDergcwc3c1FrDo-Xwx4Ct2Fi10A_A-quY12SFKt4BIyEX31Z5by7LsFEbZkGomN1/exec'; function getNameFromMasterList(scannedId) { if (!scannedId) return ''; if (masterNameList[scannedId]) return masterNameList[scannedId]; const keys = Object.keys(masterNameList); for (const key of keys) { try { const safeKey = key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); const regex = new RegExp('(?:^|\\D)' + safeKey + '(?:$|\\D)'); if (regex.test(scannedId)) return masterNameList[key]; } catch (e) { continue; } } return ''; } function updateStats() { const total = scannedUsers.length; const synced = scannedUsers.filter((u) => u.synced).length; const pending = total - synced; $('#statTotal').text(total); $('#statSynced').text(synced); $('#statPending').text(pending); } function renderTable() { const $tbody = $('#scanTableBody'); $tbody.empty(); if (scannedUsers.length === 0) { $('#emptyState').removeClass('d-none'); } else { $('#emptyState').addClass('d-none'); } const reversedUsers = [...scannedUsers].reverse(); reversedUsers.forEach((scan, i) => { const originalIndex = scannedUsers.length - i; const syncIcon = scan.synced ? '<span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill"><i class="bi bi-check-circle-fill me-1"></i>Synced</span>' : '<span class="badge bg-warning-subtle text-warning border border-warning-subtle rounded-pill"><i class="bi bi-hourglass-split me-1"></i>Pending</span>'; const rowHtml = ` <tr><td class="ps-4 text-muted small">${originalIndex}</td><td class="fw-bold text-dark">${scan.id}</td><td>${scan.name || '<span class="text-muted small">--</span>'}</td><td class="text-secondary small">${scan.time}</td><td>${syncIcon}</td></tr>`; $tbody.append(rowHtml); }); updateStats(); } function showStatus(msg, type) { const $statusDiv = $('#statusMessage'); $statusDiv.html(`<div class="alert alert-${type} shadow-sm border-0" role="alert">${msg}</div>`); setTimeout(() => { $statusDiv.empty(); }, 3000); } function syncData(scanData) { if (!GOOGLE_SCRIPT_URL.startsWith('https://script.google.com')) return; $.ajax({ url: GOOGLE_SCRIPT_URL, type: 'POST', data: JSON.stringify(scanData), contentType: 'text/plain;charset=utf-8', success: function () { const item = scannedUsers.find((u) => u.id === scanData.id && u.time === scanData.time); if (item) item.synced = true; localStorage.setItem('scannedUsers', JSON.stringify(scannedUsers)); renderTable(); }, error: function () { console.log('Sync failed (Offline?), will retry later.'); }, }); } function fetchCloudData(silent = false) { if (isClearing) return; if (!GOOGLE_SCRIPT_URL.startsWith('https://script.google.com')) { if (!silent) showStatus('‚ùå Script URL not configured', 'danger'); return; } const $btn = $('#btnSyncCloud'); let originalHtml; if (!silent) { originalHtml = $btn.html(); $btn.html('<span class="spinner-border spinner-border-sm"></span>').prop('disabled', true); } const urlWithCache = GOOGLE_SCRIPT_URL + (GOOGLE_SCRIPT_URL.includes('?') ? '&' : '?') + 't=' + new Date().getTime(); $.ajax({ url: urlWithCache, type: 'GET', dataType: 'json', crossDomain: true, success: function (data) { if (isClearing) return; let newCount = 0; data.forEach((cloudItem) => { const localItem = scannedUsers.find((local) => local.id == cloudItem.id); if (localItem) { if (cloudItem.name && !localItem.name) { localItem.name = cloudItem.name; } } else { const name = cloudItem.name || getNameFromMasterList(cloudItem.id); scannedUsers.push({ ...cloudItem, name: name, synced: true }); newCount++; } }); const cloudIds = new Set(data.map((d) => String(d.id))); const initialLength = scannedUsers.length; scannedUsers = scannedUsers.filter((u) => !u.synced || cloudIds.has(String(u.id))); const removedCount = initialLength - scannedUsers.length; if (newCount > 0 || removedCount > 0 || data.length > 0) { localStorage.setItem('scannedUsers', JSON.stringify(scannedUsers)); renderTable(); if (newCount > 0) showStatus(`‚úÖ Live Sync: Loaded ${newCount} new records.`, 'success'); if (removedCount > 0) showStatus(`üóëÔ∏è Sync: Removed ${removedCount} deleted records.`, 'warning'); } else if (!silent) { showStatus(`‚úÖ Synced! Up to date.`, 'success'); } }, error: function (xhr, status, error) { console.error('Cloud Load Error:', status, error); if (!silent) { if (xhr.status === 0) { showStatus('‚ö†Ô∏è CORS Error: Check "Anyone" permission in Google Script.', 'danger'); } else if (xhr.status === 200) { showStatus('‚ùå Error: Script returned HTML. Check "Anyone" permission.', 'danger'); } else { showStatus('‚ùå Failed to load. Check console.', 'danger'); } } }, complete: function () { if (!silent) { $btn.html(originalHtml).prop('disabled', false); } }, }); } $('#btnSyncCloud').click(function () { fetchCloudData(false); }); setInterval(() => { fetchCloudData(true); }, 3000); function processInput(data) { if (scannedUsers.some((u) => u.id === data)) { showStatus('‚ö†Ô∏è Already scanned today!', 'warning'); return; } const matchedName = getNameFromMasterList(data); const scanData = { id: data, name: matchedName, time: new Date().toLocaleString(APP_LOCALE, { timeZone: APP_TIMEZONE, hour12: true }), synced: false, }; scannedUsers.push(scanData); localStorage.setItem('scannedUsers', JSON.stringify(scannedUsers)); showStatus(`‚úÖ Recorded: ${data}`, 'success'); renderTable(); syncData(scanData); } function onScanSuccess(decodedText) { processInput(decodedText.trim()); } function onScanFailure(error) { } const html5QrcodeScanner = new Html5QrcodeScanner('reader', { fps: 10, qrbox: 250, videoConstraints: { facingMode: 'environment', }, }); html5QrcodeScanner.render(onScanSuccess, onScanFailure); $('#manualAddBtn').click(function () { const val = $('#manualInput').val().trim(); if (val) { processInput(val); $('#manualInput').val(''); } }); function loadMasterList() { fetch('qrcodeNameList.xlsx') .then((response) => { if (!response.ok) throw new Error('File not found'); return response.arrayBuffer(); }) .then((data) => { const workbook = XLSX.read(data, { type: 'array' }); const firstSheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[firstSheetName]; const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 }); let count = 0; jsonData.forEach((row, index) => { if (index === 0 && typeof row[0] === 'string' && row[0].toLowerCase().includes('id')) return; if (row[0]) { const id = String(row[0]).trim(); const name = row[1] ? String(row[1]).trim() : ''; if (id) { masterNameList[id] = name; count++; } } }); localStorage.setItem('qrcodeNameList', JSON.stringify(masterNameList)); let updated = false; scannedUsers.forEach((u) => { if (!u.name) { const found = getNameFromMasterList(u.id); if (found) { u.name = found; updated = true; } } }); if (updated) { localStorage.setItem('scannedUsers', JSON.stringify(scannedUsers)); renderTable(); } console.log(`‚úÖ Loaded ${count} names from qrcodeNameList.xlsx`); }) .catch((error) => { console.warn('Master list auto-load failed (ignore if file missing):', error); }); } loadMasterList(); window.addEventListener('online', function () { showStatus('üåê Back online! Syncing...', 'info'); scannedUsers.forEach((item) => { if (!item.synced) syncData(item); }); }); $('#btnExportExcel').click(function (e) { e.preventDefault(); if (scannedUsers.length === 0) { showStatus('‚ö†Ô∏è No data to export', 'warning'); return; } const data = scannedUsers.map((u, i) => ({ '#': i + 1, 'Unique ID': u.id, Name: u.name || '', 'Scan Time': u.time, 'Sync Status': u.synced ? 'Synced' : 'Pending', })); const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Attendance'); XLSX.writeFile(wb, 'Attendance_Log.xlsx'); showStatus('‚úÖ Excel downloaded successfully', 'success'); }); $('#btnExportPdf').click(function (e) { e.preventDefault(); if (scannedUsers.length === 0) { showStatus('‚ö†Ô∏è No data to export', 'warning'); return; } const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text('QR Attendance Log', 14, 15); doc.setFontSize(10); doc.text('Generated: ' + new Date().toLocaleString(), 14, 22); const tableColumn = ['#', 'Unique ID', 'Name', 'Scan Time', 'Sync Status']; const tableRows = scannedUsers.map((u, i) => [i + 1, u.id, u.name || '', u.time, u.synced ? 'Synced' : 'Pending']); doc.autoTable({ head: [tableColumn], body: tableRows, startY: 30, }); doc.save('Attendance_Log.pdf'); showStatus('‚úÖ PDF downloaded successfully', 'success'); }); $('#clearBtn').click(function () { if (confirm('‚ö†Ô∏è DELETE ALL DATA? This will wipe Google Sheets and local history.')) { isClearing = true; const $btn = $(this); const originalHtml = $btn.html(); $btn.html('<span class="spinner-border spinner-border-sm"></span>').prop('disabled', true); const clearLocal = () => { localStorage.removeItem('scannedUsers'); scannedUsers = []; renderTable(); }; if (GOOGLE_SCRIPT_URL.startsWith('https://script.google.com')) { $.ajax({ url: GOOGLE_SCRIPT_URL, type: 'POST', data: JSON.stringify({ action: 'clear' }), contentType: 'text/plain;charset=utf-8', success: function () { clearLocal(); showStatus('‚úÖ Cloud & Local data cleared!', 'success'); }, error: function () { clearLocal(); showStatus('‚ö†Ô∏è Local cleared. Cloud clear failed.', 'warning'); }, complete: function () { isClearing = false; $btn.html(originalHtml).prop('disabled', false); }, }); } else { clearLocal(); showStatus('‚úÖ Local data cleared.', 'success'); isClearing = false; $btn.html(originalHtml).prop('disabled', false); } } }); renderTable(); }); </script></body></html>